import React from 'react';
import {
  Canvas,
  RoundedRect,
  Path,
  Group,
  Shadow,
} from '@shopify/react-native-skia';
import {Card, CardSuit} from '~/types/cards';
import {useSharedValue, withRepeat, withTiming} from 'react-native-reanimated';

interface CardProps {
  card: Card;
  width?: number;
  height?: number;
  glowing?: boolean;
}

interface SuitProps {
  size: 'small' | 'normal';
  color: string;
  cardX?: number;
  cardY?: number;
}

const CARD_COLORS: Record<CardSuit, string> = {
  clubs: '#000000',
  diamonds: '#E53E3E',
  hearts: '#E53E3E',
  spades: '#000000',
};

// SVG path data for card values
const VALUE_PATHS: string[] = [
  'M7.90301 15.7495C6.94168 15.7495 6.19501 15.4975 5.66301 14.9935C5.14034 14.4895 4.80901 13.8268 4.66901 13.0055L6.65701 12.6135C6.73168 13.0241 6.87168 13.3415 7.07701 13.5655C7.28234 13.7801 7.54834 13.8875 7.87501 13.8875C8.18301 13.8875 8.44434 13.7895 8.65901 13.5935C8.88301 13.3975 8.99501 13.0895 8.99501 12.6695V7.53146H6.02701V5.82346H11.123V12.7675C11.123 13.3648 10.9923 13.8875 10.731 14.3355C10.479 14.7835 10.1103 15.1335 9.62501 15.3855C9.14901 15.6281 8.57501 15.7495 7.90301 15.7495ZM8.2301 27.7635C7.37143 27.7635 6.61543 27.5721 5.9621 27.1895C5.3181 26.8068 4.81876 26.2421 4.4641 25.4955C4.10943 24.7395 3.9321 23.8108 3.9321 22.7095C3.9321 21.5988 4.10943 20.6701 4.4641 19.9235C4.81876 19.1768 5.3181 18.6121 5.9621 18.2295C6.61543 17.8468 7.37143 17.6555 8.2301 17.6555C9.0981 17.6555 9.8541 17.8468 10.4981 18.2295C11.1421 18.6121 11.6414 19.1768 11.9961 19.9235C12.3508 20.6701 12.5281 21.5988 12.5281 22.7095C12.5281 23.8108 12.3508 24.7395 11.9961 25.4955C11.6414 26.2421 11.1421 26.8068 10.4981 27.1895C9.8541 27.5721 9.0981 27.7635 8.2301 27.7635ZM8.2301 25.8735C8.65943 25.8735 9.02343 25.7801 9.3221 25.5935C9.6301 25.3975 9.86343 25.1175 10.0221 24.7535C10.1901 24.3895 10.2741 23.9508 10.2741 23.4375V21.9815C10.2741 21.4588 10.1901 21.0201 10.0221 20.6655C9.86343 20.3015 9.6301 20.0261 9.3221 19.8395C9.02343 19.6435 8.65943 19.5455 8.2301 19.5455C7.8101 19.5455 7.4461 19.6435 7.1381 19.8395C6.8301 20.0261 6.5921 20.3015 6.4241 20.6655C6.26543 21.0201 6.1861 21.4588 6.1861 21.9815V23.4375C6.1861 23.9508 6.26543 24.3895 6.4241 24.7535C6.5921 25.1175 6.8301 25.3975 7.1381 25.5935C7.4461 25.7801 7.8101 25.8735 8.2301 25.8735ZM4.43314 40.5955V30.8235H6.56114V35.4715H6.64514L8.03114 33.5815L10.2291 30.8235H12.6371L9.34714 34.8415L12.9311 40.5955H10.4251L7.83514 36.3395L6.56114 37.8795V40.5955H4.43314ZM5.05521 52.5955V42.8235H11.7052V44.7135H7.18321V46.7155H11.0612V48.5915H7.18321V50.7055H11.7052V52.5955H5.05521ZM4.59037 65.5955V55.8235H9.22437C9.83104 55.8235 10.3537 55.9541 10.7924 56.2155C11.231 56.4768 11.5717 56.8408 11.8144 57.3075C12.057 57.7741 12.1784 58.3201 12.1784 58.9455C12.1784 59.5988 12.029 60.1775 11.7304 60.6815C11.441 61.1761 10.9977 61.5355 10.4004 61.7595L12.3184 65.5955H9.95237L8.24437 62.0115H6.71837V65.5955H4.59037ZM6.71837 60.2195H8.95837C9.17304 60.2195 9.35504 60.1821 9.50437 60.1075C9.6537 60.0328 9.77037 59.9255 9.85437 59.7855C9.93837 59.6361 9.98037 59.4588 9.98037 59.2535V58.6375C9.98037 58.4228 9.93837 58.2455 9.85437 58.1055C9.77037 57.9655 9.6537 57.8581 9.50437 57.7835C9.35504 57.7088 9.17304 57.6715 8.95837 57.6715H6.71837V60.2195Z',
  'M9.5168 20.7125L11.1368 20.9125C11.1901 21.1125 11.1901 21.3592 11.1368 21.6525C10.2968 21.6125 9.59014 21.5925 9.0168 21.5925C8.6968 21.5925 7.9768 21.6059 6.8568 21.6325C6.7768 21.3925 6.7768 21.1525 6.8568 20.9125L8.1768 20.6725C8.39014 20.3525 8.6568 19.7592 8.9768 18.8925L14.1368 5.09253H14.8368L20.6368 20.7125L22.2568 20.9125C22.3101 21.1125 22.3101 21.3592 22.2568 21.6525C21.4168 21.6125 20.4768 21.5925 19.4368 21.5925C18.6635 21.5925 17.7168 21.6059 16.5968 21.6325C16.5168 21.3925 16.5168 21.1525 16.5968 20.9125L18.2568 20.6725L16.4968 15.7325H11.2968L9.5168 20.7125ZM13.9568 8.11253H13.9368C13.7768 8.7392 13.5168 9.5592 13.1568 10.5725L11.6568 14.7325H16.1368L14.6768 10.5725C14.3968 9.7592 14.1568 8.9392 13.9568 8.11253Z',
  'M6.20072 23V19.575L11.5757 14.975C12.559 14.1417 13.2424 13.4333 13.6257 12.85C14.009 12.25 14.2007 11.5833 14.2007 10.85V10.5C14.2007 9.83333 13.959 9.33333 13.4757 9C12.9924 8.66667 12.4674 8.5 11.9007 8.5C11.084 8.5 10.459 8.74167 10.0257 9.225C9.59238 9.70833 9.28405 10.2833 9.10072 10.95L5.82572 9.7C6.09238 8.88333 6.49238 8.14167 7.02572 7.475C7.57572 6.80833 8.28405 6.275 9.15072 5.875C10.0174 5.45833 11.0507 5.25 12.2507 5.25C13.5174 5.25 14.5924 5.48333 15.4757 5.95C16.3591 6.4 17.034 7.01667 17.5007 7.8C17.9674 8.58333 18.2007 9.48333 18.2007 10.5C18.2007 11.5 17.984 12.3917 17.5507 13.175C17.134 13.9417 16.5674 14.6583 15.8507 15.325C15.1507 15.975 14.384 16.6333 13.5507 17.3L10.3007 19.85H18.5507V23H6.20072Z',
  'M11.6257 23.3C10.4424 23.3 9.44238 23.15 8.62572 22.85C7.80905 22.5333 7.12572 22.1167 6.57572 21.6C6.02572 21.0833 5.55905 20.5333 5.17572 19.95L7.95072 17.8C8.33405 18.5167 8.80905 19.1083 9.37572 19.575C9.94238 20.025 10.6924 20.25 11.6257 20.25C12.4757 20.25 13.134 20.0333 13.6007 19.6C14.084 19.1667 14.3257 18.5917 14.3257 17.875V17.725C14.3257 17.0083 14.0507 16.475 13.5007 16.125C12.9674 15.7583 12.2257 15.575 11.2757 15.575H9.70072V12.45H11.3257C12.259 12.45 12.934 12.275 13.3507 11.925C13.784 11.5583 14.0007 11.1083 14.0007 10.575V10.4C14.0007 9.76667 13.7924 9.25833 13.3757 8.875C12.959 8.49167 12.384 8.3 11.6507 8.3C10.9507 8.3 10.2924 8.48333 9.67572 8.85C9.05905 9.2 8.53405 9.70833 8.10072 10.375L5.75072 8.175C6.20072 7.59167 6.70072 7.08333 7.25072 6.65C7.80072 6.21667 8.44238 5.875 9.17572 5.625C9.90905 5.375 10.7757 5.25 11.7757 5.25C13.0257 5.25 14.109 5.44167 15.0257 5.825C15.959 6.20833 16.6757 6.75 17.1757 7.45C17.6924 8.13333 17.9507 8.94167 17.9507 9.875C17.9507 10.9917 17.6174 11.8833 16.9507 12.55C16.3007 13.2167 15.5257 13.6333 14.6257 13.8V13.95C15.3257 14.0667 15.9424 14.3083 16.4757 14.675C17.0257 15.025 17.4591 15.4917 17.7757 16.075C18.0924 16.6583 18.2507 17.35 18.2507 18.15C18.2507 19.1833 17.9674 20.0917 17.4007 20.875C16.8507 21.6417 16.0757 22.2417 15.0757 22.675C14.0924 23.0917 12.9424 23.3 11.6257 23.3Z',
  'M13.2007 23V19.65H5.52572V16.45L12.3257 5.55H16.7757V16.75H18.9757V19.65H16.7757V23H13.2007ZM8.52572 16.75H13.2007V9.425H12.9507L8.52572 16.75Z',
  'M12.1507 23.3C11.034 23.3 10.0757 23.15 9.27572 22.85C8.47572 22.5333 7.80072 22.1167 7.25072 21.6C6.71738 21.0833 6.27572 20.5333 5.92572 19.95L8.65072 17.8C9.03405 18.4667 9.49238 19.0417 10.0257 19.525C10.559 20.0083 11.2757 20.25 12.1757 20.25C13.0757 20.25 13.7507 19.9917 14.2007 19.475C14.6674 18.9583 14.9007 18.275 14.9007 17.425V17.225C14.9007 16.425 14.6674 15.7917 14.2007 15.325C13.734 14.8583 13.0924 14.625 12.2757 14.625C11.609 14.625 11.0507 14.7667 10.6007 15.05C10.1507 15.3167 9.80905 15.5833 9.57572 15.85L6.50072 15.425L7.15072 5.55H17.8257V8.825H9.90072L9.52572 14.35H9.72572C9.95905 13.8 10.2257 13.3167 10.5257 12.9C10.8257 12.4833 11.209 12.1583 11.6757 11.925C12.1424 11.6917 12.7424 11.575 13.4757 11.575C14.4757 11.575 15.3757 11.8 16.1757 12.25C16.9924 12.6833 17.6424 13.3167 18.1257 14.15C18.609 14.9667 18.8507 15.9583 18.8507 17.125C18.8507 18.3083 18.5924 19.3667 18.0757 20.3C17.559 21.2333 16.8007 21.9667 15.8007 22.5C14.8007 23.0333 13.584 23.3 12.1507 23.3Z',
  'M12.3757 23.3C10.9924 23.3 9.80905 23.0167 8.82572 22.45C7.85905 21.8833 7.11738 21.0833 6.60072 20.05C6.08405 19 5.82572 17.775 5.82572 16.375C5.82572 15.1417 6.00905 13.9833 6.37572 12.9C6.74238 11.8167 7.22572 10.8167 7.82572 9.9C8.44238 8.96667 9.11738 8.13333 9.85072 7.4C10.584 6.66667 11.3257 6.05 12.0757 5.55H17.2507C15.834 6.56667 14.609 7.53333 13.5757 8.45C12.5424 9.35 11.7007 10.275 11.0507 11.225C10.4174 12.1583 9.98405 13.1833 9.75072 14.3L9.97572 14.375C10.1757 13.925 10.434 13.5 10.7507 13.1C11.0674 12.7 11.4757 12.375 11.9757 12.125C12.4757 11.875 13.0924 11.75 13.8257 11.75C14.7924 11.75 15.659 11.975 16.4257 12.425C17.1924 12.8583 17.8007 13.4833 18.2507 14.3C18.7007 15.1167 18.9257 16.075 18.9257 17.175C18.9257 18.3583 18.6507 19.4167 18.1007 20.35C17.5674 21.2667 16.8091 21.9917 15.8257 22.525C14.859 23.0417 13.709 23.3 12.3757 23.3ZM12.3757 20.375C12.9257 20.375 13.3924 20.275 13.7757 20.075C14.1757 19.8583 14.484 19.5583 14.7007 19.175C14.9174 18.775 15.0257 18.2917 15.0257 17.725V17.275C15.0257 16.7083 14.9174 16.2333 14.7007 15.85C14.484 15.45 14.1757 15.15 13.7757 14.95C13.3924 14.7333 12.9257 14.625 12.3757 14.625C11.8257 14.625 11.3507 14.7333 10.9507 14.95C10.5674 15.15 10.2674 15.45 10.0507 15.85C9.83405 16.2333 9.72572 16.7083 9.72572 17.275V17.725C9.72572 18.2917 9.83405 18.775 10.0507 19.175C10.2674 19.5583 10.5674 19.8583 10.9507 20.075C11.3507 20.275 11.8257 20.375 12.3757 20.375Z',
  'M8.92572 23L14.7757 8.6H9.32572V11.775H6.15072V5.55H18.5007V8.8L12.8757 23H8.92572Z',
  'M12.2757 23.3C10.909 23.3 9.73405 23.0833 8.75072 22.65C7.78405 22.2 7.04238 21.5917 6.52572 20.825C6.02572 20.0583 5.77572 19.1917 5.77572 18.225C5.77572 17.1083 6.08405 16.2 6.70072 15.5C7.33405 14.7833 8.16738 14.2833 9.20072 14V13.8C8.35072 13.4833 7.65072 13 7.10072 12.35C6.56738 11.7 6.30072 10.8667 6.30072 9.85C6.30072 8.51667 6.81738 7.41667 7.85072 6.55C8.88405 5.68333 10.359 5.25 12.2757 5.25C14.209 5.25 15.684 5.68333 16.7007 6.55C17.734 7.41667 18.2507 8.51667 18.2507 9.85C18.2507 10.8667 17.9757 11.7 17.4257 12.35C16.8924 13 16.2007 13.4833 15.3507 13.8V14C16.384 14.2833 17.209 14.7833 17.8257 15.5C18.459 16.2 18.7757 17.1083 18.7757 18.225C18.7757 19.1917 18.5174 20.0583 18.0007 20.825C17.5007 21.5917 16.7674 22.2 15.8007 22.65C14.834 23.0833 13.659 23.3 12.2757 23.3ZM12.2757 20.425C13.109 20.425 13.7424 20.225 14.1757 19.825C14.6257 19.425 14.8507 18.8833 14.8507 18.2V17.7C14.8507 17.0167 14.6257 16.475 14.1757 16.075C13.7424 15.675 13.109 15.475 12.2757 15.475C11.459 15.475 10.8257 15.675 10.3757 16.075C9.92572 16.475 9.70072 17.0167 9.70072 17.7V18.2C9.70072 18.8833 9.92572 19.425 10.3757 19.825C10.8257 20.225 11.459 20.425 12.2757 20.425ZM12.2757 12.725C13.059 12.725 13.659 12.5417 14.0757 12.175C14.509 11.7917 14.7257 11.275 14.7257 10.625V10.225C14.7257 9.575 14.509 9.06667 14.0757 8.7C13.659 8.31667 13.059 8.125 12.2757 8.125C11.4924 8.125 10.884 8.31667 10.4507 8.7C10.034 9.06667 9.82572 9.575 9.82572 10.225V10.625C9.82572 11.275 10.034 11.7917 10.4507 12.175C10.884 12.5417 11.4924 12.725 12.2757 12.725Z',
  'M7.30072 23C8.71738 21.9833 9.94238 21.025 10.9757 20.125C12.009 19.2083 12.8424 18.275 13.4757 17.325C14.1257 16.375 14.5674 15.35 14.8007 14.25L14.5757 14.175C14.3757 14.6083 14.1174 15.0333 13.8007 15.45C13.484 15.85 13.0757 16.175 12.5757 16.425C12.0924 16.675 11.4757 16.8 10.7257 16.8C9.77572 16.8 8.90905 16.575 8.12572 16.125C7.35905 15.675 6.75072 15.05 6.30072 14.25C5.85072 13.4333 5.62572 12.475 5.62572 11.375C5.62572 10.175 5.89238 9.11667 6.42572 8.2C6.97572 7.28333 7.74238 6.56667 8.72572 6.05C9.70905 5.51667 10.859 5.25 12.1757 5.25C13.559 5.25 14.734 5.53333 15.7007 6.1C16.684 6.66667 17.434 7.475 17.9507 8.525C18.4674 9.55833 18.7257 10.775 18.7257 12.175C18.7257 13.3917 18.5424 14.55 18.1757 15.65C17.809 16.7333 17.3174 17.7417 16.7007 18.675C16.1007 19.5917 15.434 20.4167 14.7007 21.15C13.9674 21.8833 13.2257 22.5 12.4757 23H7.30072ZM12.1757 13.925C12.7257 13.925 13.1924 13.825 13.5757 13.625C13.9757 13.4083 14.284 13.1083 14.5007 12.725C14.7174 12.325 14.8257 11.8417 14.8257 11.275V10.825C14.8257 10.2583 14.7174 9.78333 14.5007 9.4C14.284 9 13.9757 8.7 13.5757 8.5C13.1924 8.28333 12.7257 8.175 12.1757 8.175C11.6257 8.175 11.1507 8.28333 10.7507 8.5C10.3674 8.7 10.0674 9 9.85072 9.4C9.63405 9.78333 9.52572 10.2583 9.52572 10.825V11.275C9.52572 11.8417 9.63405 12.325 9.85072 12.725C10.0674 13.1083 10.3674 13.4083 10.7507 13.625C11.1507 13.825 11.6257 13.925 12.1757 13.925Z',
  'M4.37659 21V18.338H8.51259V8.042H8.31459L5.19059 12.134L3.07859 10.484L6.75259 5.644H11.8126V18.338H15.0686V21H4.37659ZM22.1 21.264C20.0907 21.264 18.602 20.5673 17.634 19.174C16.666 17.7807 16.182 15.83 16.182 13.322C16.182 10.814 16.666 8.86333 17.634 7.47C18.602 6.07667 20.0907 5.38 22.1 5.38C24.1093 5.38 25.598 6.07667 26.566 7.47C27.534 8.86333 28.018 10.814 28.018 13.322C28.018 15.83 27.534 17.7807 26.566 19.174C25.598 20.5673 24.1093 21.264 22.1 21.264ZM22.1 18.47C22.6867 18.47 23.1487 18.3233 23.486 18.03C23.8233 17.7367 24.0653 17.3187 24.212 16.776C24.3587 16.2187 24.432 15.5513 24.432 14.774V11.87C24.432 11.0927 24.3587 10.4327 24.212 9.89C24.0653 9.33267 23.8233 8.90733 23.486 8.614C23.1487 8.32067 22.6867 8.174 22.1 8.174C21.5133 8.174 21.0513 8.32067 20.714 8.614C20.3767 8.90733 20.1347 9.33267 19.988 9.89C19.8413 10.4327 19.768 11.0927 19.768 11.87V14.774C19.768 15.5513 19.8413 16.2187 19.988 16.776C20.1347 17.3187 20.3767 17.7367 20.714 18.03C21.0513 18.3233 21.5133 18.47 22.1 18.47Z',
  'M10.4409 24.264C8.79288 24.264 7.51288 23.832 6.60088 22.968C5.70488 22.104 5.13688 20.968 4.89688 19.56L8.30488 18.888C8.43288 19.592 8.67288 20.136 9.02488 20.52C9.37688 20.888 9.83288 21.072 10.3929 21.072C10.9209 21.072 11.3689 20.904 11.7369 20.568C12.1209 20.232 12.3129 19.704 12.3129 18.984V10.176H7.22488V7.248H15.9609V19.152C15.9609 20.176 15.7369 21.072 15.2889 21.84C14.8569 22.608 14.2249 23.208 13.3929 23.64C12.5769 24.056 11.5929 24.264 10.4409 24.264Z',
  'M12.5068 17.888L14.4028 15.848L20.2588 21.416L18.3628 23.456L12.5068 17.888ZM12.0028 23.336C10.4028 23.336 8.97881 22.976 7.73081 22.256C6.48281 21.528 5.50281 20.512 4.79081 19.208C4.07881 17.896 3.72281 16.36 3.72281 14.6C3.72281 12.84 4.07881 11.308 4.79081 10.004C5.50281 8.692 6.48281 7.676 7.73081 6.956C8.97881 6.228 10.4028 5.864 12.0028 5.864C13.6028 5.864 15.0268 6.228 16.2748 6.956C17.5228 7.676 18.5028 8.692 19.2148 10.004C19.9268 11.308 20.2828 12.84 20.2828 14.6C20.2828 16.36 19.9268 17.896 19.2148 19.208C18.5028 20.512 17.5228 21.528 16.2748 22.256C15.0268 22.976 13.6028 23.336 12.0028 23.336ZM12.0028 20.36C13.1228 20.36 14.0588 20.112 14.8108 19.616C15.5628 19.12 16.1268 18.44 16.5028 17.576C16.8788 16.704 17.0668 15.712 17.0668 14.6C17.0668 13.488 16.8788 12.5 16.5028 11.636C16.1268 10.764 15.5628 10.08 14.8108 9.584C14.0588 9.088 13.1228 8.84 12.0028 8.84C10.8828 8.84 9.94681 9.088 9.19481 9.584C8.44281 10.08 7.87881 10.764 7.50281 11.636C7.12681 12.5 6.93881 13.488 6.93881 14.6C6.93881 15.712 7.12681 16.704 7.50281 17.576C7.87881 18.44 8.44281 19.12 9.19481 19.616C9.94681 20.112 10.8828 20.36 12.0028 20.36Z',
  'M4.49253 24V7.248H8.14053V15.216H8.28453L10.6605 11.976L14.4285 7.248H18.5565L12.9165 14.136L19.0605 24H14.7645L10.3245 16.704L8.14053 19.344V24H4.49253Z',
];

// Suit path definitions
const SUIT_PATHS = {
  club: {
    normal: {
      topCircle:
        'M25.4167 44.1713C29.3006 44.1713 32.4492 40.9989 32.4492 37.0856C32.4492 33.1723 29.3006 30 25.4167 30C21.5327 30 18.3842 33.1723 18.3842 37.0856C18.3842 40.9989 21.5327 44.1713 25.4167 44.1713Z',
      leftCircle:
        'M18.0325 55.8624C21.9165 55.8624 25.065 52.6901 25.065 48.7768C25.065 44.8635 21.9165 41.6912 18.0325 41.6912C14.1486 41.6912 11 44.8635 11 48.7768C11 52.6901 14.1486 55.8624 18.0325 55.8624Z',
      rightCircle:
        'M32.8008 55.8624C36.6848 55.8624 39.8334 52.6901 39.8334 48.7768C39.8334 44.8635 36.6848 41.6912 32.8008 41.6912C28.9169 41.6912 25.7683 44.8635 25.7683 48.7768C25.7683 52.6901 28.9169 55.8624 32.8008 55.8624Z',
      centerCircle:
        'M25.4166 48.0684C26.9702 48.0684 28.2297 46.7995 28.2297 45.2342C28.2297 43.6688 26.9702 42.3999 25.4166 42.3999C23.8631 42.3999 22.6036 43.6688 22.6036 45.2342C22.6036 46.7995 23.8631 48.0684 25.4166 48.0684Z',
      stem: 'M24.7134 50.194C24.479 51.6111 24.2446 53.0283 24.0101 54.4454C23.7757 55.8625 23.4241 57.0435 22.9553 57.9882C22.4864 58.933 22.1348 59.6415 21.9004 60.1139H28.9329C28.6985 59.6415 28.3469 58.933 27.878 57.9882C27.4092 57.0435 27.0576 55.8625 26.8232 54.4454C26.5887 53.0283 26.3543 51.6111 26.1199 50.194C25.8855 49.2493 25.7683 48.4226 25.7683 47.714C25.6511 47.0055 25.5339 46.415 25.4167 45.9426C25.2994 46.415 25.1822 47.0055 25.065 47.714C25.065 48.4226 24.9478 49.2493 24.7134 50.194Z',
    },
    small: {
      topCircle:
        'M11.3542 36.6249C13.4589 36.6249 15.1652 34.9442 15.1652 32.8709C15.1652 30.7977 13.4589 29.1169 11.3542 29.1169C9.24944 29.1169 7.54321 30.7977 7.54321 32.8709C7.54321 34.9442 9.24944 36.6249 11.3542 36.6249Z',
      leftCircle:
        'M7.35266 42.8188C9.45741 42.8188 11.1636 41.138 11.1636 39.0648C11.1636 36.9915 9.45741 35.3108 7.35266 35.3108C5.24792 35.3108 3.54169 36.9915 3.54169 39.0648C3.54169 41.138 5.24792 42.8188 7.35266 42.8188Z',
      rightCircle:
        'M15.3557 42.8188C17.4605 42.8188 19.1667 41.138 19.1667 39.0648C19.1667 36.9915 17.4605 35.3108 15.3557 35.3108C13.251 35.3108 11.5447 36.9915 11.5447 39.0648C11.5447 41.138 13.251 42.8188 15.3557 42.8188Z',
      centerCircle:
        'M11.3542 38.6895C12.1961 38.6895 12.8786 38.0172 12.8786 37.1879C12.8786 36.3586 12.1961 35.6863 11.3542 35.6863C10.5123 35.6863 9.82977 36.3586 9.82977 37.1879C9.82977 38.0172 10.5123 38.6895 11.3542 38.6895Z',
      stem: 'M10.9731 39.8156C10.8461 40.5664 10.7191 41.3172 10.592 42.068C10.465 42.8188 10.2744 43.4445 10.0204 43.945C9.76631 44.4455 9.57576 44.8209 9.44873 45.0712H13.2597C13.1327 44.8209 12.9421 44.4455 12.6881 43.945C12.434 43.4445 12.2434 42.8188 12.1164 42.068C11.9894 41.3172 11.8623 40.5664 11.7353 39.8156C11.6083 39.3151 11.5448 38.8771 11.5448 38.5017C11.4813 38.1263 11.4177 37.8135 11.3542 37.5632C11.2907 37.8135 11.2272 38.1263 11.1637 38.5017C11.1637 38.8771 11.1002 39.3151 10.9731 39.8156Z',
    },
  },
  diamond: {
    normal:
      'M24.7934 32.1396C28.473 37.0172 32.2609 41.4513 36.157 45.442C32.2609 49.4327 28.473 53.8668 24.7934 58.7443C21.1137 53.8668 17.3259 49.4327 13.4297 45.442C17.3259 41.4513 21.1137 37.0172 24.7934 32.1396Z',
    small:
      'M11.3542 29.4294C13.4792 32.1822 15.6667 34.6847 17.9167 36.9369C15.6667 39.1892 13.4792 41.6917 11.3542 44.4445C9.22919 41.6917 7.04169 39.1892 4.79169 36.9369C7.04169 34.6847 9.22919 32.1822 11.3542 29.4294Z',
  },
  heart: {
    normal:
      'M24.6901 59.9148C17.9506 54.7148 10.5372 49.5148 10.5372 42.5815C10.5372 37.3815 13.9069 33.9148 18.9615 33.9148C21.9943 33.9148 24.0161 36.3415 24.3531 38.4215C25.364 36.3415 27.3859 33.9148 30.4186 33.9148C35.4732 33.9148 38.843 37.3815 38.843 42.5815C38.843 49.5148 31.4295 54.7148 24.6901 59.9148Z',
    small:
      'M11.4584 45.2455C7.68857 42.0823 3.54175 38.9192 3.54175 34.7016C3.54175 31.5385 5.42667 29.4297 8.25405 29.4297C9.95048 29.4297 11.0814 30.9058 11.2699 32.1711C11.8354 30.9058 12.9664 29.4297 14.6628 29.4297C17.4902 29.4297 19.3751 31.5385 19.3751 34.7016C19.3751 38.9192 15.2283 42.0823 11.4584 45.2455Z',
  },
  spade: {
    normal: {
      suit: 'M25 32C19.4945 37.5 13 41.6 13 48C13 52.8 16 56 20.5 55C23.1711 54.4064 23.6154 53.3462 25 51.5C26.3846 53.3462 27.2473 54.4994 29.5 55C34 56 37 52.8 37 48C37 41.6 30.5385 37.5 25 32Z',
      stem: 'M24.4 50.2C24.2 51.6 24 53 23.8 54.4C23.6 55.8 23.3 56.9667 22.9 57.9C22.5 58.8333 21.7 59.5333 21.5 60H28.5C28.3 59.5333 27.5 58.8333 27.1 57.9C26.7 56.9667 26.4 55.8 26.2 54.4C26 53 25.8 51.6 25.6 50.2C25.4 49.2667 25.3 48.45 25.3 47.75C25.2 47.05 25.1 46.4667 25 46C24.9 46.4667 24.8 47.05 24.7 47.75C24.7 48.45 24.6 49.2667 24.4 50.2Z',
    },
    small: {
      suit: 'M11.3542 28.8284C7.63395 31.7112 3.54169 34.5941 3.54169 38.4379C3.54169 41.3208 5.40181 43.2427 8.19198 43.2427C9.86609 43.2427 10.9822 41.8973 11.1682 40.7442C11.7262 41.8973 12.8423 43.2427 14.5164 43.2427C17.3066 43.2427 19.1667 41.3208 19.1667 38.4379C19.1667 34.5941 15.0744 31.7112 11.3542 28.8284Z',
      stem: 'M10.9583 39.9195C10.8263 40.6802 10.6944 41.441 10.5624 42.2017C10.4305 42.9625 10.2326 43.5965 9.96869 44.1036C9.7048 44.6108 9.50688 44.9912 9.37494 45.2448H13.3333C13.2013 44.9912 13.0034 44.6108 12.7395 44.1036C12.4756 43.5965 12.2777 42.9625 12.1458 42.2017C12.0138 41.441 11.8819 40.6802 11.7499 39.9195C11.618 39.4123 11.552 38.9685 11.552 38.5882C11.486 38.2078 11.4201 37.8908 11.3541 37.6372C11.2881 37.8908 11.2222 38.2078 11.1562 38.5882C11.1562 38.9685 11.0902 39.4123 10.9583 39.9195Z',
    },
  },
};

// Card Suit
const ClubSuit: React.FC<SuitProps> = ({size, color, cardX = 0, cardY = 0}) => {
  const paths = SUIT_PATHS.club[size];
  return (
    <Group transform={[{translateX: cardX}, {translateY: cardY}]}>
      <Path path={paths.topCircle} color={color} />
      <Path path={paths.leftCircle} color={color} />
      <Path path={paths.rightCircle} color={color} />
      <Path path={paths.centerCircle} color={color} />
      <Path path={paths.stem} color={color} />
    </Group>
  );
};

const DiamondSuit: React.FC<SuitProps> = ({
  size,
  color,
  cardX = 0,
  cardY = 0,
}) => {
  const path = SUIT_PATHS.diamond[size];
  return (
    <Path
      path={path}
      color={color}
      transform={[{translateX: cardX}, {translateY: cardY}]}
    />
  );
};
const HeartSuit: React.FC<SuitProps> = ({
  size,
  color,
  cardX = 0,
  cardY = 0,
}) => {
  const path = SUIT_PATHS.heart[size];
  return (
    <Path
      path={path}
      color={color}
      transform={[{translateX: cardX}, {translateY: cardY}]}
    />
  );
};
const SpadeSuit: React.FC<SuitProps> = ({
  size,
  color,
  cardX = 0,
  cardY = 0,
}) => {
  const paths = SUIT_PATHS.spade[size];
  return (
    <Group transform={[{translateX: cardX}, {translateY: cardY}]}>
      <Path path={paths.suit} color={color} />
      <Path path={paths.stem} color={color} />
    </Group>
  );
};

// suits mapper:
const cardToSuit: Record<CardSuit, React.FC<SuitProps>> = {
  clubs: ClubSuit,
  diamonds: DiamondSuit,
  hearts: HeartSuit,
  spades: SpadeSuit,
};

// Enhanced Background with glow support
const Background: React.FC<{
  width: number;
  height: number;
  cardX: number;
  cardY: number;
  glowing?: boolean;
}> = ({width, height, cardX, cardY, glowing = false}) => {
  // Continuous glow animation - always pulsing up and down
  const glowProgress = useSharedValue(0);

  React.useEffect(() => {
    if (glowing) {
      glowProgress.value = withRepeat(withTiming(1, {duration: 300}), -1, true);
    } else {
      glowProgress.value = 0;
    }
  }, [glowProgress, glowing]);

  return (
    <>
      {/* Cartoonish shadow - offset and darker / Glow effect */}

      {!glowing && (
        <RoundedRect
          x={0}
          y={0}
          width={width + cardX * 2}
          height={height + cardY * 2}
          r={8}
          color={'#b8a08218'}
        />
      )}

      {glowing && (
        <RoundedRect
          x={cardX}
          y={cardY}
          width={width}
          height={height}
          r={8}
          color="#FFF8E6"
          opacity={glowProgress}>
          <Shadow dx={0} dy={0} blur={2} color="#FFD700" />
        </RoundedRect>
      )}

      {/* Main card */}
      <RoundedRect
        x={cardX}
        y={cardY}
        width={width}
        height={height}
        r={8}
        color={glowing ? '#fff9ecff' : '#FFF8E6'}
      />

      {/* Card border */}
      <RoundedRect
        x={cardX + 0.5}
        y={cardY + 0.5}
        width={width - 1}
        height={height - 1}
        r={7.5}
        style="stroke"
        strokeWidth={1}
        color="#E6D9B7"
      />
    </>
  );
};

// Main card component
export const CardComponent: React.FC<CardProps> = ({
  card,
  width = 50,
  height = 70,
  glowing = false,
}) => {
  const {suit, value} = card;
  const color = CARD_COLORS[suit];
  const suitSize = value > 10 ? 'small' : 'normal';
  const Suit = cardToSuit[suit];

  const shadowPadding = 2;
  const canvasWidth = width + shadowPadding * 2;
  const canvasHeight = height + shadowPadding * 2;

  const cardX = shadowPadding;
  const cardY = shadowPadding;

  return (
    <Canvas
      style={{
        width: canvasWidth,
        height: canvasHeight,
      }}>
      <Background
        width={width}
        height={height}
        cardX={cardX}
        cardY={cardY}
        glowing={glowing}
      />
      {value > 0 && (
        <Suit size={suitSize} color={color} cardX={cardX} cardY={cardY} />
      )}
      <Path
        path={VALUE_PATHS[value]}
        color={color}
        transform={[{translateX: cardX}, {translateY: cardY}]}
      />
    </Canvas>
  );
};
